pipeline {
    agent any

    stages {    
    
        stage('Build Infomation')
        {
            steps
            {
                slackSend channel: '#jenkins', color: "#439FE0", message: 'Build CheckinPro API :dart:'         
            }
        }
        stage('Clean Source')
        {
            steps
            {
                slackSend channel: '#jenkins', message: 'Get source :grin:'
                sh 'echo "Clean Workspace"'
                sh '''          
                rm -rf $WORKSPACE/*          
                '''
            }
        }

        stage('Checkout') {
            steps {
                git branch: 'develop', url:'https://namht:N%40mhtgc60226@glc.unit.vn/checkinpro/checkinpro.git'
            }
        }
        
        stage('build') {
            steps {
                sh '''
                    export comment=`git log -1  --pretty='%s'`
                    if [[ "$comment" == *"fire"* ]];
                    then                    
                    cd $WORKSPACE/BE/CIP/nCanary.API
                    dotnet build                  
                    fi
                '''          
                }
            }
        
        stage('build Docker') {

            steps {
                sh 'cd $WORKSPACE/BE/CIP/nCanary.API && docker build -t registry.unit.vn/checkinpro-api:1.${BUILD_NUMBER} .'
                sh 'docker push registry.unit.vn/checkinpro-api:1.${BUILD_NUMBER}'
                slackSend channel: '#jenkins', message: "deploy xong roài đại ca. Image: registry.unit.vn/checkinpro-api:1.${BUILD_NUMBER}"
                }
            }   
    }
}
